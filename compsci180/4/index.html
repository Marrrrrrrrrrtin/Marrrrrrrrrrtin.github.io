<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Project 3A — Image Warping & Mosaicing</title>
  
  <!-- KaTeX CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
  
  <!-- KaTeX JavaScript -->
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
  
  <!-- KaTeX auto-render extension -->
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
      onload="renderMathInElement(document.body, {
        delimiters: [
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false}
        ]
      });"></script>
  
  <style>
    :root {
      --bg: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --accent: #111827;
      --maxw: 980px;
      --radius: 14px;
    }
    html, body { background: var(--bg); color: var(--text); }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 0; line-height: 1.6; }
    a { color: var(--accent); text-decoration: underline; }
    img { max-width: 100%; height: auto; border-radius: 10px; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }

    .wrap { max-width: var(--maxw); margin: 0 auto; padding: 28px 18px 80px; }
    header { border-bottom: 1px solid var(--border); padding: 22px 0 18px; margin-bottom: 18px; }
    header h1 { margin: 0 0 6px; font-size: 28px; }
    header .sub { color: var(--muted); font-size: 14px; }

    section { padding: 22px 0; border-top: 1px solid var(--border); }
    section h2 { margin: 0 0 8px; font-size: 22px; }
    section h3 { margin: 14px 0 6px; font-size: 16px; color: var(--muted); font-weight: 600; }
    p.lead { margin-top: 0; color: var(--muted); }

    .grid { display: grid; gap: 12px; }
    .grid.cols-2 { grid-template-columns: repeat(2, minmax(0,1fr)); }
    .grid.cols-3 { grid-template-columns: repeat(3, minmax(0,1fr)); }
    @media (max-width: 680px) { .grid.cols-2, .grid.cols-3 { grid-template-columns: 1fr; } }

    .card { border: 1px solid var(--border); border-radius: var(--radius); padding: 12px; background: #fff; }
    .figcap { font-size: 13px; color: var(--muted); margin-top: 6px; }

    pre { border: 1px solid var(--border); background: #fafafa; padding: 12px; border-radius: 12px; overflow: auto; }
    footer { border-top: 1px solid var(--border); margin-top: 28px; padding-top: 18px; color: var(--muted); font-size: 14px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Project 3A — Image Warping &amp; Mosaicing</h1>
      <div class="sub">CS180/280A · Fall 2025 · Zimu Wang</div>
    </header>

    <section id="summary">
      <h2>Summary</h2>
      <p class="lead">In this project I capture overlapping photos and build panoramas by estimating homographies, warping with inverse mapping, and blending with feathering / pyramids.</p>
    </section>

    <section id="a1">
      <h2>A.1 — Shoot and Digitize Pictures</h2>
      <p>Two photos per mosaic, ~40–70% FOV overlap. Below are my raw inputs.</p>
      <div class="grid cols-2">
        <figure class="card"><img src="images/a1_set1_1.jpg"><figcaption class="figcap">CalDay Left</figcaption></figure>
        <figure class="card"><img src="images/a1_set1_2.jpg"><figcaption class="figcap">CalDay Right</figcaption></figure>
      </div>
      <div class="grid cols-2">
        <figure class="card"><img src="images/a1_set2_1.jpg"><figcaption class="figcap">Campanile Down</figcaption></figure>
        <figure class="card"><img src="images/a1_set2_2.jpg"><figcaption class="figcap">Campanile Up</figcaption></figure>
      </div>
      <div class="grid cols-2">
        <figure class="card"><img src="images/a1_set3_1.jpg"><figcaption class="figcap">My Apartment Roof Left</figcaption></figure>
        <figure class="card"><img src="images/a1_set3_2.jpg"><figcaption class="figcap">My Apartment Roof Right</figcaption></figure>
      </div>
    </section>

    <section id="a2">
      <h2>A.2 — Recover Homographies</h2>
      <p>In this part, we want to solve for the homography matrix $H$ that maps points from one image to another.
        For $(x,y,1)$ in image 1 and $(u,v,1)$ in image 2, we have:</p>
      
      <div style="text-align: center; margin: 20px 0;">
        $$\begin{bmatrix} u \\ v \\ 1 \end{bmatrix} \sim H \begin{bmatrix} x \\ y \\ 1 \end{bmatrix}$$
      </div>

      <p>This gives us two equations per point correspondence. With some linear algebra, we can set up a linear system $A\mathbf{h} = \mathbf{b}$, where:</p>

      <div style="text-align: center; margin: 25px 0;">
        $$A = \begin{bmatrix}
        x_1 & y_1 & 1 & 0 & 0 & 0 & -u_1x_1 & -u_1y_1 \\
        0 & 0 & 0 & x_1 & y_1 & 1 & -v_1x_1 & -v_1y_1 \\
        x_2 & y_2 & 1 & 0 & 0 & 0 & -u_2x_2 & -u_2y_2 \\
        0 & 0 & 0 & x_2 & y_2 & 1 & -v_2x_2 & -v_2y_2 \\
        x_3 & y_3 & 1 & 0 & 0 & 0 & -u_3x_3 & -u_3y_3 \\
        0 & 0 & 0 & x_3 & y_3 & 1 & -v_3x_3 & -v_3y_3 \\
        x_4 & y_4 & 1 & 0 & 0 & 0 & -u_4x_4 & -u_4y_4 \\
        0 & 0 & 0 & x_4 & y_4 & 1 & -v_4x_4 & -v_4y_4
        \end{bmatrix}$$
      </div>

      <div style="text-align: center; margin: 25px 0;">
        $$\mathbf{h} = \begin{bmatrix}
        h_{11} \\
        h_{12} \\
        h_{13} \\
        h_{21} \\
        h_{22} \\
        h_{23} \\
        h_{31} \\
        h_{32}
        \end{bmatrix}, \quad
        \mathbf{b} = \begin{bmatrix}
        u_1 \\
        v_1 \\
        u_2 \\
        v_2 \\
        u_3 \\
        v_3 \\
        u_4 \\
        v_4
        \end{bmatrix}$$
      </div>

      <p>In this part, I manually select 4 pairs of corresponding points in each image pair to construct the matrix $A$ and vector $\mathbf{b}$, then solve for $\mathbf{h}$. As I only choose 4 points, the system is exactly determined, but in practice, more points can be used for a least-squares solution.</p>

      <p>Below are the point correspondences I used for each image pair, along with the transformed $A$ and $\mathbf{b}$, and finally the solved homography matrix $H$.</p>
      
      <div class="grid cols-2">
        <figure class="card"><img src="images/a2_set1_1.jpg"><figcaption class="figcap">CalDay Left</figcaption></figure>
        <figure class="card"><img src="images/a2_set1_2.jpg"><figcaption class="figcap">CalDay Right</figcaption></figure>
      </div>

      <h3>Point Correspondences</h3>
      <div style="display: flex; justify-content: space-around; margin: 20px 0;">
        <div style="text-align: center;">
          <h4 style="margin-bottom: 10px;">Left Image Points</h4>
          $$\begin{bmatrix}
          2008 & 1324 \\
          2461 & 1115 \\
          2689 & 1126 \\
          3169 & 1374
          \end{bmatrix}$$
        </div>
        <div style="text-align: center;">
          <h4 style="margin-bottom: 10px;">Right Image Points</h4>
          $$\begin{bmatrix}
          820 & 1339 \\
          1334 & 1115 \\
          1544 & 1115 \\
          1931 & 1320
          \end{bmatrix}$$
        </div>
      </div>

      <h3>Constructed Matrix $A$ and Vector $\mathbf{b}$</h3>
      <div style="text-align: center; margin: 25px 0;">
        $$A = \begin{bmatrix}
        2008 & 1324 & 1 & 0 & 0 & 0 & -1.647 \times 10^6 & -1.086 \times 10^6 \\
        0 & 0 & 0 & 2008 & 1324 & 1 & -2.689 \times 10^6 & -1.773 \times 10^6 \\
        2461 & 1115 & 1 & 0 & 0 & 0 & -3.283 \times 10^6 & -1.487 \times 10^6 \\
        0 & 0 & 0 & 2461 & 1115 & 1 & -2.744 \times 10^6 & -1.243 \times 10^6 \\
        2689 & 1126 & 1 & 0 & 0 & 0 & -4.152 \times 10^6 & -1.739 \times 10^6 \\
        0 & 0 & 0 & 2689 & 1126 & 1 & -2.998 \times 10^6 & -1.255 \times 10^6 \\
        3169 & 1374 & 1 & 0 & 0 & 0 & -6.119 \times 10^6 & -2.653 \times 10^6 \\
        0 & 0 & 0 & 3169 & 1374 & 1 & -4.183 \times 10^6 & -1.814 \times 10^6
        \end{bmatrix}$$
      </div>

      <div style="text-align: center; margin: 25px 0;">
        $$\mathbf{b} = \begin{bmatrix} 820 \\ 1339 \\ 1334 \\ 1115 \\ 1544 \\ 1115 \\ 1931 \\ 1320 \end{bmatrix}$$
      </div>

      <h3>Solved Homography Matrix $H$</h3>
      <div style="text-align: center; margin: 25px 0;">
        $$H = \begin{bmatrix}
        1.003 & -0.458 & -649.537 \\
        0.021 & 0.735 & 221.850 \\
        5.733 \times 10^{-5} & -1.444 \times 10^{-4} & 1.000
        \end{bmatrix}$$
      </div>
      <div class="grid cols-2">
        <figure class="card"><img src="images/a2_set2_1.jpg"><figcaption class="figcap">Campanile Down</figcaption></figure>
        <figure class="card"><img src="images/a2_set2_2.jpg"><figcaption class="figcap">Campanile Up</figcaption></figure>
      </div>

      <h3>Point Correspondences</h3>
      <div style="display: flex; justify-content: space-around; margin: 20px 0;">
        <div style="text-align: center;">
          <h4 style="margin-bottom: 10px;">Up Image Points</h4>
          $$\begin{bmatrix}
          742 & 817 \\
          988 & 804 \\
          742 & 1004 \\
          988 & 1012
          \end{bmatrix}$$
        </div>
        <div style="text-align: center;">
          <h4 style="margin-bottom: 10px;">Down Image Points</h4>
          $$\begin{bmatrix}
          722 & 56 \\
          996 & 56 \\
          726 & 310 \\
          992 & 310
          \end{bmatrix}$$
        </div>
      </div>

      <h3>Constructed Matrix $A$ and Vector $\mathbf{b}$</h3>
      <div style="text-align: center; margin: 25px 0;">
        $$A = \begin{bmatrix}
        742 & 817 & 1 & 0 & 0 & 0 & -5.357 \times 10^5 & -5.899 \times 10^5 \\
        0 & 0 & 0 & 742 & 817 & 1 & -4.155 \times 10^4 & -4.575 \times 10^4 \\
        988 & 804 & 1 & 0 & 0 & 0 & -9.840 \times 10^5 & -8.008 \times 10^5 \\
        0 & 0 & 0 & 988 & 804 & 1 & -5.533 \times 10^4 & -4.502 \times 10^4 \\
        742 & 1004 & 1 & 0 & 0 & 0 & -5.387 \times 10^5 & -7.289 \times 10^5 \\
        0 & 0 & 0 & 742 & 1004 & 1 & -2.300 \times 10^5 & -3.112 \times 10^5 \\
        988 & 1012 & 1 & 0 & 0 & 0 & -9.801 \times 10^5 & -1.004 \times 10^6 \\
        0 & 0 & 0 & 988 & 1012 & 1 & -3.063 \times 10^5 & -3.137 \times 10^5
        \end{bmatrix}$$
      </div>

      <div style="text-align: center; margin: 25px 0;">
        $$\mathbf{b} = \begin{bmatrix} 722 \\ 56 \\ 996 \\ 56 \\ 726 \\ 310 \\ 992 \\ 310 \end{bmatrix}$$
      </div>

      <h3>Solved Homography Matrix $H$</h3>
      <div style="text-align: center; margin: 25px 0;">
        $$H = \begin{bmatrix}
        3.010 & 0.264 & -1069.793 \\
        0.191 & 2.690 & -2232.054 \\
        8.881 \times 10^{-4} & 3.072 \times 10^{-4} & 1.000
        \end{bmatrix}$$
      </div>

      <div class="grid cols-2">
        <figure class="card"><img src="images/a2_set3_1.jpg"><figcaption class="figcap">My Apartment Roof Left</figcaption></figure>
        <figure class="card"><img src="images/a2_set3_2.jpg"><figcaption class="figcap">My Apartment Roof Right</figcaption></figure>
      </div>

      <h3>Point Correspondences</h3>
      <div style="display: flex; justify-content: space-around; margin: 20px 0;">
        <div style="text-align: center;">
          <h4 style="margin-bottom: 10px;">Left Image Points</h4>
          $$\begin{bmatrix}
          692 & 1032 \\
          433 & 1152 \\
          1054 & 1206 \\
          1082 & 1386
          \end{bmatrix}$$
        </div>
        <div style="text-align: center;">
          <h4 style="margin-bottom: 10px;">Right Image Points</h4>
          $$\begin{bmatrix}
          338 & 1039 \\
          45 & 1176 \\
          689 & 1176 \\
          719 & 1339
          \end{bmatrix}$$
        </div>
      </div>

      <h3>Constructed Matrix $A$ and Vector $\mathbf{b}$</h3>
      <div style="text-align: center; margin: 25px 0;">
        $$A = \begin{bmatrix}
        692 & 1032 & 1 & 0 & 0 & 0 & -2.339 \times 10^5 & -3.488 \times 10^5 \\
        0 & 0 & 0 & 692 & 1032 & 1 & -7.190 \times 10^5 & -1.072 \times 10^6 \\
        433 & 1152 & 1 & 0 & 0 & 0 & -1.949 \times 10^4 & -5.184 \times 10^4 \\
        0 & 0 & 0 & 433 & 1152 & 1 & -5.092 \times 10^5 & -1.355 \times 10^6 \\
        1054 & 1206 & 1 & 0 & 0 & 0 & -7.262 \times 10^5 & -8.309 \times 10^5 \\
        0 & 0 & 0 & 1054 & 1206 & 1 & -1.240 \times 10^6 & -1.418 \times 10^6 \\
        1082 & 1386 & 1 & 0 & 0 & 0 & -7.780 \times 10^5 & -9.965 \times 10^5 \\
        0 & 0 & 0 & 1082 & 1386 & 1 & -1.449 \times 10^6 & -1.856 \times 10^6
        \end{bmatrix}$$
      </div>

      <div style="text-align: center; margin: 25px 0;">
        $$\mathbf{b} = \begin{bmatrix} 338 \\ 1039 \\ 45 \\ 1176 \\ 689 \\ 1176 \\ 719 \\ 1339 \end{bmatrix}$$
      </div>

      <h3>Solved Homography Matrix $H$</h3>
      <div style="text-align: center; margin: 25px 0;">
        $$H = \begin{bmatrix}
        1.157 & -0.061 & -387.790 \\
        0.196 & 0.846 & 66.810 \\
        2.401 \times 10^{-4} & -1.266 \times 10^{-4} & 1.000
        \end{bmatrix}$$
      </div>
    </section>

    <section id="a3">
      <h2>A.3 — Warp the Images (Inverse Mapping)</h2>
      <p>I implement nearest‑neighbor and bilinear interpolation using inverse warping to rectify images with nearest‑neighbor and bilinear interpolation.</p>
      <div class="grid cols-3">
        <figure class="card"><img src="images/a3_src_1.jpg"><figcaption class="figcap">Source image</figcaption></figure>
        <figure class="card"><img src="images/a3_nn_1.jpg"><figcaption class="figcap">Nearest neighbor warp</figcaption></figure>
        <figure class="card"><img src="images/a3_bilinear_1.jpg"><figcaption class="figcap">Bilinear warp</figcaption></figure>
      </div>

      <div class="grid cols-3">
        <figure class="card"><img src="images/a3_src_2.jpg"><figcaption class="figcap">Source image</figcaption></figure>
        <figure class="card"><img src="images/a3_nn_2.jpg"><figcaption class="figcap">Nearest neighbor warp</figcaption></figure>
        <figure class="card"><img src="images/a3_bilinear_2.jpg"><figcaption class="figcap">Bilinear warp</figcaption></figure>
      </div>

      <div class="card" style="margin-top: 20px;">
        <h3 style="margin-top: 0; color: var(--text);">Comparison</h3>
        <p>
          The qualities of the bilinear and nearest‑neighbor interpolation methods are really similar in my examples. In the first example, as there are lots of words, the clarity of bilinear warping is slightly better.
      </div>
    </section>

    <section id="a4">
      <h2>A.4 — Blend Images into a Mosaic (source images are from part A.1)</h2>
      <div class="grid cols-1">
        <figure class="card"><img src="images/mosaic1.jpg"><figcaption class="figcap">Mosaic 1</figcaption></figure>
      </div>
      <div class="grid cols-1">
        <figure class="card"><img src="images/mosaic2.jpg"><figcaption class="figcap">Mosaic 2</figcaption></figure>
      </div>
      <div class="grid cols-1">
        <figure class="card"><img src="images/mosaic3.jpg"><figcaption class="figcap">Mosaic 3</figcaption></figure>
      </div> 

      <div class="card" style="margin-top: 20px;">
        <h3 style="margin-top: 0; color: var(--text);">Pipeline</h3>
        <ol style="margin: 0; padding-left: 20px;">
          <li style="margin-bottom: 8px;">
            Use the homography matrix $H$ computed in part A.2 to warp one image to the coordinate system of the other.
          </li>
          <li style="margin-bottom: 8px;">
            Based on the matrix $H$, create a new canvas that can fit both images, and multiply a translation matrix to adjust the origin.
          </li>
          <li style="margin-bottom: 8px;">
            Blend the warped image and the reference image together using alpha blending.
          </li>
        </ol>
      </div>
    </section>
    <footer>
      <div>© 2025 Zimu Wang. Assignment spec: “Image Warping and Mosaicing (Part A)” — CS180/280A.</div>
    </footer>
  </div>
</body>
</html>
